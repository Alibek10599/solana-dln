# =============================================================================
# DLN Solana Dashboard - Environment Configuration
# =============================================================================
# Copy this file to .env and update the values
# 
#   cp .env.example .env
#
# =============================================================================

# =============================================================================
# Solana RPC Configuration
# =============================================================================

# Single RPC endpoint (basic setup)
SOLANA_RPC_URL=https://api.mainnet-beta.solana.com

# =============================================================================
# Multi-RPC Pool Configuration (Recommended for speed!)
# =============================================================================
# 
# For faster collection, use multiple RPC endpoints.
# Format: url1,url2,url3 or url1|name1|maxRps1,url2|name2|maxRps2
#
# Examples:
#
# Basic (comma-separated URLs):
# RPC_URLS=https://api.mainnet-beta.solana.com,https://rpc.ankr.com/solana
#
# Advanced (with custom names and rate limits):
# RPC_URLS=https://api.mainnet-beta.solana.com|public|10,https://mainnet.helius-rpc.com/?api-key=XXX|helius|50
#
# Recommended providers:
# - Helius (free: 10 req/s, paid: 50-100 req/s)
# - QuickNode (25-50 req/s depending on plan)
# - Triton (100 req/s)
# - Alchemy (25 req/s)
# - Public RPC (10 req/s, often less)

RPC_URLS=

# =============================================================================
# Parallel Fetcher Configuration
# =============================================================================

# Number of concurrent fetch requests (default: 5)
# Increase if you have multiple RPCs or premium endpoints
FETCH_CONCURRENCY=5

# Batch size for getParsedTransactions API (default: 50)
# Some RPCs support up to 100, public RPC may need 20-30
FETCH_BATCH_SIZE=50

# Use batch API (getParsedTransactions) instead of individual fetches
# Set to 'false' for RPCs that don't support batch requests
RPC_BATCH_REQUESTS=true

# =============================================================================
# Circuit Breaker Configuration
# =============================================================================

# Number of failures before opening circuit (default: 5)
CIRCUIT_FAILURE_THRESHOLD=5

# Time in ms before attempting recovery (default: 30000)
CIRCUIT_RECOVERY_TIMEOUT=30000

# =============================================================================
# ClickHouse Database
# =============================================================================

CLICKHOUSE_URL=http://localhost:8123
CLICKHOUSE_DATABASE=dln_dashboard
CLICKHOUSE_USER=default
CLICKHOUSE_PASSWORD=

# Docker ports (only change if you have conflicts)
CLICKHOUSE_PORT=8123
CLICKHOUSE_NATIVE_PORT=9001

# =============================================================================
# API Server
# =============================================================================

API_PORT=3001
LOG_LEVEL=info

# =============================================================================
# Dashboard
# =============================================================================

DASHBOARD_PORT=3000

# =============================================================================
# Collection Settings
# =============================================================================

# Target order counts
TARGET_CREATED_ORDERS=25000
TARGET_FULFILLED_ORDERS=25000

# Run collections in parallel (true/false)
COLLECTION_PARALLEL=true

# Signatures per batch (getSignaturesForAddress limit)
SIGNATURES_BATCH_SIZE=1000

# Transactions per batch for parsing
# With multi-RPC pool: 100 recommended
# With single public RPC: 20-30 recommended
TX_BATCH_SIZE=100

# Delay between batches in ms
# With multi-RPC pool: 100ms
# With single public RPC: 500ms
BATCH_DELAY_MS=100

# =============================================================================
# Temporal Configuration
# =============================================================================

# Server address (use 'temporal:7233' in Docker, 'localhost:7233' for local dev)
TEMPORAL_ADDRESS=localhost:7233
TEMPORAL_NAMESPACE=default

# Task queues
TEMPORAL_TASK_QUEUE=dln-collector
TEMPORAL_RPC_QUEUE=dln-rpc
TEMPORAL_DB_QUEUE=dln-db

# Docker ports
TEMPORAL_PORT=7233
TEMPORAL_UI_PORT=8233

# Image versions
TEMPORAL_VERSION=1.24
TEMPORAL_UI_VERSION=2.26.2

# Temporal database (PostgreSQL)
TEMPORAL_DB_USER=temporal
TEMPORAL_DB_PASSWORD=temporal
TEMPORAL_DB_NAME=temporal

# =============================================================================
# Worker Configuration
# =============================================================================

# Worker mode: full | rpc | db | workflow
# - full: Handle all queues (default, good for development)
# - rpc: Only RPC activities (for dedicated RPC workers)
# - db: Only DB activities (for dedicated DB workers)
# - workflow: Only workflow tasks
WORKER_MODE=full

# Maximum concurrent workflow task executions
WORKER_MAX_WORKFLOW_TASKS=10

# Maximum concurrent activity executions
WORKER_MAX_ACTIVITIES=10

# Rate limit for RPC activities (per worker)
WORKER_ACTIVITIES_PER_SECOND=20

# =============================================================================
# Speed Configuration Presets
# =============================================================================
#
# SLOW (Single public RPC):
#   SOLANA_RPC_URL=https://api.mainnet-beta.solana.com
#   TX_BATCH_SIZE=20
#   BATCH_DELAY_MS=500
#   FETCH_CONCURRENCY=2
#   Expected: ~2-4 hours for 50k orders
#
# MEDIUM (Single premium RPC):
#   SOLANA_RPC_URL=https://mainnet.helius-rpc.com/?api-key=XXX
#   TX_BATCH_SIZE=50
#   BATCH_DELAY_MS=200
#   FETCH_CONCURRENCY=5
#   Expected: ~1-2 hours for 50k orders
#
# FAST (Multi-RPC pool):
#   RPC_URLS=https://url1,https://url2,https://url3
#   TX_BATCH_SIZE=100
#   BATCH_DELAY_MS=100
#   FETCH_CONCURRENCY=10
#   Expected: ~20-40 minutes for 50k orders
#
# =============================================================================

# =============================================================================
# Scaled Worker Configuration (for docker-compose --profile scaled)
# =============================================================================

# RPC Worker settings
WORKER_RPC_MAX_ACTIVITIES=5
WORKER_RPC_RATE_LIMIT=10

# DB Worker settings
WORKER_DB_MAX_ACTIVITIES=20

# =============================================================================
# Monitoring (docker-compose --profile monitoring)
# =============================================================================

# Prometheus
PROMETHEUS_PORT=9090

# Grafana
GRAFANA_PORT=3002
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=admin

# Access URLs when monitoring is enabled:
# - Prometheus: http://localhost:9090
# - Grafana:    http://localhost:3002 (login: admin/admin)
# - Metrics:    http://localhost:3001/metrics
