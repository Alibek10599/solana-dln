# =============================================================================
# DLN Solana Dashboard - Environment Configuration
# =============================================================================
# Copy this file to .env and update the values
# 
#   cp .env.example .env
#
# =============================================================================

# =============================================================================
# Solana RPC Configuration
# =============================================================================

# Single RPC endpoint (basic setup)
SOLANA_RPC_URL=https://api.mainnet-beta.solana.com

# =============================================================================
# Multi-RPC Pool Configuration (Recommended for speed!)
# =============================================================================
#
# For faster collection, use multiple RPC endpoints.
# Format: url1|name1|maxRps1,url2|name2|maxRps2,url3|name3|maxRps3
#
# Recommended providers:
# - Helius (free: 10 req/s, paid: 50-100 req/s) - https://helius.dev
# - QuickNode (25-50 req/s depending on plan) - https://quicknode.com
# - Ankr (30 req/s free tier) - https://ankr.com
# - Triton (100 req/s) - https://triton.one
# - Alchemy (25 req/s) - https://alchemy.com
# - Public RPC (10 req/s, often less) - https://api.mainnet-beta.solana.com
#
# Examples:
#
# Basic setup (Helius + Ankr + Public):
# RPC_URLS=https://mainnet.helius-rpc.com/?api-key=YOUR_HELIUS_KEY|helius|50,https://rpc.ankr.com/solana|ankr|30,https://api.mainnet-beta.solana.com|public|10
#
# Recommended setup (Helius + QuickNode + Ankr):
# RPC_URLS=https://mainnet.helius-rpc.com/?api-key=YOUR_HELIUS_KEY|helius|50,https://YOUR-ENDPOINT.quiknode.pro/YOUR_KEY|quicknode|25,https://rpc.ankr.com/solana|ankr|30
#
# High-performance setup (add more premium RPCs):
# RPC_URLS=https://mainnet.helius-rpc.com/?api-key=YOUR_KEY|helius|50,https://YOUR-ENDPOINT.quiknode.pro/YOUR_KEY|quicknode|25,https://rpc.ankr.com/solana|ankr|30,https://solana-mainnet.g.alchemy.com/v2/YOUR_KEY|alchemy|25

RPC_URLS=https://mainnet.helius-rpc.com/?api-key=YOUR_HELIUS_KEY|helius|50,https://rpc.ankr.com/solana|ankr|30,https://api.mainnet-beta.solana.com|public|10

# =============================================================================
# Parallel Fetcher Configuration
# =============================================================================

# Number of concurrent fetch requests
# - Single RPC: 3-5 (default: 5)
# - Multi-RPC (2-3 endpoints): 10
# - Multi-RPC (4+ endpoints): 15
FETCH_CONCURRENCY=10

# Batch size for getParsedTransactions API
# - Premium RPCs: 50-100 (default: 50)
# - Public RPC: 20-30
FETCH_BATCH_SIZE=50

# Use batch API (getParsedTransactions) instead of individual fetches
# Set to 'false' for RPCs that don't support batch requests
RPC_BATCH_REQUESTS=true

# =============================================================================
# Circuit Breaker Configuration
# =============================================================================

# Number of failures before opening circuit (default: 5)
CIRCUIT_FAILURE_THRESHOLD=5

# Time in ms before attempting recovery (default: 30000)
CIRCUIT_RECOVERY_TIMEOUT=30000

# =============================================================================
# ClickHouse Database
# =============================================================================

CLICKHOUSE_URL=http://localhost:8123
CLICKHOUSE_DATABASE=dln_dashboard
CLICKHOUSE_USER=default
CLICKHOUSE_PASSWORD=

# Docker ports (only change if you have conflicts)
CLICKHOUSE_PORT=8123
CLICKHOUSE_NATIVE_PORT=9001

# =============================================================================
# API Server
# =============================================================================

API_PORT=3001
LOG_LEVEL=info

# =============================================================================
# Dashboard
# =============================================================================

DASHBOARD_PORT=3000

# =============================================================================
# Collection Settings
# =============================================================================

# Target order counts
TARGET_CREATED_ORDERS=25000
TARGET_FULFILLED_ORDERS=25000

# Run collections in parallel (true/false)
COLLECTION_PARALLEL=true

# Signatures per batch (getSignaturesForAddress limit)
SIGNATURES_BATCH_SIZE=1000

# Transactions per batch for parsing
# - Single public RPC: 20-30
# - Single premium RPC: 50-100
# - Multi-RPC pool (2-3 endpoints): 100 (default)
# - Multi-RPC pool (4+ endpoints): 150
TX_BATCH_SIZE=100

# Delay between batches in milliseconds
# - Single public RPC: 500ms
# - Single premium RPC: 200ms
# - Multi-RPC pool (2-3 endpoints): 100ms (default)
# - Multi-RPC pool (4+ endpoints): 50ms
BATCH_DELAY_MS=100

# =============================================================================
# Temporal Configuration
# =============================================================================

# Server address (use 'temporal:7233' in Docker, 'localhost:7233' for local dev)
TEMPORAL_ADDRESS=localhost:7233
TEMPORAL_NAMESPACE=default

# Task queues
TEMPORAL_TASK_QUEUE=dln-collector
TEMPORAL_RPC_QUEUE=dln-rpc
TEMPORAL_DB_QUEUE=dln-db

# Docker ports
TEMPORAL_PORT=7233
TEMPORAL_UI_PORT=8233

# Image versions
TEMPORAL_VERSION=1.24
TEMPORAL_UI_VERSION=2.26.2

# Temporal database (PostgreSQL)
TEMPORAL_DB_USER=temporal
TEMPORAL_DB_PASSWORD=temporal
TEMPORAL_DB_NAME=temporal

# =============================================================================
# Worker Configuration
# =============================================================================

# Worker mode: full | rpc | db | workflow
# - full: Handle all queues (default, good for development)
# - rpc: Only RPC activities (for dedicated RPC workers)
# - db: Only DB activities (for dedicated DB workers)
# - workflow: Only workflow tasks
WORKER_MODE=full

# Maximum concurrent workflow task executions
WORKER_MAX_WORKFLOW_TASKS=10

# Maximum concurrent activity executions
WORKER_MAX_ACTIVITIES=10

# Rate limit for RPC activities (per worker)
WORKER_ACTIVITIES_PER_SECOND=20

# =============================================================================
# Performance Tuning Presets
# =============================================================================
#
# Choose a preset based on your RPC setup:
#
# ðŸ“Š BASIC (Single public RPC) - ~2-4 hours for 50k orders:
#   SOLANA_RPC_URL=https://api.mainnet-beta.solana.com
#   TX_BATCH_SIZE=20
#   BATCH_DELAY_MS=500
#   FETCH_CONCURRENCY=3
#
# âš¡ OPTIMIZED (2-3 RPCs) - ~30-45 minutes for 50k orders:
#   RPC_URLS=https://helius-url|helius|50,https://ankr-url|ankr|30,https://public-url|public|10
#   TX_BATCH_SIZE=100
#   BATCH_DELAY_MS=100
#   FETCH_CONCURRENCY=10
#
# ðŸš€ AGGRESSIVE (3+ RPCs with QuickNode) - ~20-30 minutes for 50k orders:
#   RPC_URLS=https://helius-url|helius|50,https://quicknode-url|quicknode|25,https://ankr-url|ankr|30
#   TX_BATCH_SIZE=150
#   BATCH_DELAY_MS=50
#   FETCH_CONCURRENCY=15
#
# Performance metrics (actual results):
# - Basic: ~2-4 orders/sec
# - Optimized: ~8-12 orders/sec
# - Aggressive: ~15-25 orders/sec
#
# =============================================================================

# =============================================================================
# Scaled Worker Configuration (for docker-compose --profile scaled)
# =============================================================================

# RPC Worker settings
WORKER_RPC_MAX_ACTIVITIES=5
WORKER_RPC_RATE_LIMIT=10

# DB Worker settings
WORKER_DB_MAX_ACTIVITIES=20

# =============================================================================
# Monitoring (docker-compose --profile monitoring)
# =============================================================================

# Prometheus
PROMETHEUS_PORT=9090

# Grafana
GRAFANA_PORT=3002
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=admin

# Access URLs when monitoring is enabled:
# - Prometheus: http://localhost:9090
# - Grafana:    http://localhost:3002 (login: admin/admin)
# - Metrics:    http://localhost:3001/metrics
